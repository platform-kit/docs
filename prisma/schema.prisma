generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  @@map(name: "users")
  id                Int                @id @default(autoincrement())
  uuid              String             @unique @default(uuid()) @db.Uuid
  email             String?
  oauth_id          String             @unique
  username          String             @unique
  name              String?
  bio               String?
  website           String?
  tags              Json?
  roles             Json?
  permissions       Json?
  topics            Json?
  pages             Page[]
  images            Image[]           
  contentItems      ContentItem[]
  docs              Doc[]
  subscriptionPlans SubscriptionPlan[]
  analyticEvents    AnalyticEvent[]
  Products          Product[]
  stripeId          String             @unique
  avatar            String?
  status            UserStatus?        @default(Enabled)
}

enum UserStatus {
  Enabled
  Disabled
}

model Image {
  @@map(name: "images")
  id        Int      @id @default(autoincrement())
  uuid      String   @unique @default(uuid()) @db.Uuid
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  publishAt DateTime @default(now())
  base64    String?
  published Boolean  @default(false)
  user      User     @relation(fields: [userId], references: [id])
  userId    Int
  json      Json
}

model Page {
  @@map(name: "pages")
  id        Int      @id @default(autoincrement())
  uuid      String   @unique @default(uuid()) @db.Uuid
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  publishAt DateTime @default(now())
  content   String?
  published Boolean  @default(false)
  user      User     @relation(fields: [userId], references: [id])
  userId    Int
  json      Json
}

enum ContentType {
  text
  audio
  video
  link
  iframe
}

model ContentItem {
  @@map(name: "content_items")
  id                 Int               @id @default(autoincrement())
  uuid               String            @unique @default(uuid()) @db.Uuid
  createdAt          DateTime          @default(now())
  updatedAt          DateTime          @updatedAt
  publishAt          DateTime          @default(now())
  contentType        ContentType       @default(text)
  thumbnail          String?
  cover              String?
  contentPreview     String
  content            String    
  attributes         Json?    
  draft_content      String?
  draft_attributes   Json?  
  excerpt            String?
  published          Boolean           @default(false)
  user               User              @relation(fields: [userId], references: [id])
  userId             Int
  json               Json
  requiredPlan       SubscriptionPlan? @relation(fields: [subscriptionPlanId], references: [id])
  subscriptionPlanId Int
}

model Doc {
  @@map(name: "docs")
  id                 Int               @id @default(autoincrement())
  uuid               String            @unique @default(uuid()) @db.Uuid
  createdAt          DateTime          @default(now())
  updatedAt          DateTime          @updatedAt
  deletedAt          DateTime          @updatedAt
  publishAt          DateTime          @default(now())      
  content            String    
  attributes         Json?    
  draft_content      String?
  draft_attributes   Json?
  published          Boolean           @default(false)
  repo               String             
  path               String             
  git_url            String            @unique  
  json               Json    
  user               User?             @relation(fields: [userId], references: [id])
  userId             Int
}

enum PricingInterval {
  day
  week
  month
  year
}

model Product {
  @@map(name: "products")
  id          Int      @id @default(autoincrement())
  uuid        String   @unique @default(uuid()) @db.Uuid
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  publishAt   DateTime @default(now())
  thumbnail   String?
  name        String  
  description String
  slug        String   @unique
  price_usd   Int
  published   Boolean  @default(false)
  user        User?    @relation(fields: [userId], references: [id])
  userId      Int?
  stripeId    String?  @unique
}

model SubscriptionPlan {
  @@map(name: "subscription_plans")
  id          Int             @id @default(autoincrement())
  uuid        String          @unique @default(uuid()) @db.Uuid
  createdAt   DateTime        @default(now())
  updatedAt   DateTime        @updatedAt
  publishAt   DateTime        @default(now())
  name        String
  description String
  slug        String
  price_usd   Int
  interval    PricingInterval @default(month)
  published   Boolean         @default(false)
  user        User?           @relation(fields: [userId], references: [id])
  userId      Int?
  stripeId    String?         @unique
  ContentItem ContentItem[]
}

model AnalyticEvent {
  @@map(name: "analytic_events")
  id          Int      @id @default(autoincrement())
  uuid        String   @unique @default(uuid()) @db.Uuid
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  type        String
  object      String?
  description String?
  user        User?    @relation(fields: [userId], references: [id])
  userId      Int?
  json        Json?
}
